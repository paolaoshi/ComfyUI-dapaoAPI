# GLM 提示词润色节点使用说明

## 📖 节点简介

GLM 提示词润色节点基于智谱 AI 的 GLM-4 大语言模型，能够智能优化和扩展您的提示词，使其更适合AI图像生成，并提供多种预设优化方案。

## 🎯 主要功能

- ✅ 智能提示词扩写与优化
- ✅ 3种预设优化方案
- ✅ 自定义优化指令
- ✅ 长度智能控制
- ✅ 种子控制（固定/随机/递增）
- ✅ 多模型选择

## 📝 参数说明

### 必填参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| **提示词 (prompt)** | STRING | 需要优化的原始提示词 |
| **API Key** | STRING | 智谱 AI API 密钥 |

### 可选参数

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| **优化方案 (optimization_preset)** | DROPDOWN | 即梦文生图 | 预设的优化模板 |
| **自定义指令 (custom_instruction)** | STRING | 空 | 自定义优化要求（优先级最高） |
| **模型 (model)** | DROPDOWN | GLM-4-Flash | 使用的 GLM 模型 |
| **最大长度 (max_length)** | INT | 500 | 输出提示词最大长度 |
| **种子控制 (seed_control)** | DROPDOWN | 随机 | 种子生成方式 |
| **种子值 (seed)** | INT | 0 | 固定种子值 |
| **温度 (temperature)** | FLOAT | 0.7 | 输出随机性（0.0-1.0） |
| **top_p** | FLOAT | 0.9 | 核采样参数（0.0-1.0） |

## 🎨 优化方案说明

### 1. 即梦文生图（默认方案）
**适用场景**：通用AI绘画、Seedream等文生图模型  
**优化重点**：
- 丰富画面细节描述
- 添加专业摄影/绘画术语
- 优化色彩、光线、构图描述
- 适合各类风格的图像生成

**示例**：
```
输入：一只猫
输出：一只可爱的橘色虎斑猫，毛发蓬松柔软，绿色眼睛明亮有神，趴在温暖的阳光下，慵懒舒适的姿态，柔和的自然光线，浅景深背景虚化，高清细腻，温馨治愈的氛围
```

### 2. 即梦多图编辑
**适用场景**：Seedream多图编辑、图像融合、风格迁移  
**优化重点**：
- 强调图像融合效果
- 描述元素间的关系
- 突出整体风格统一性
- 适合多图混合场景

**示例**：
```
输入：融合城市和自然
输出：将现代都市建筑与自然森林元素有机融合，高楼大厦被绿色植物缠绕，玻璃幕墙倒映着蓝天白云，街道上生长着参天大树，人造与自然和谐共存，生态城市的未来景象，梦幻而真实的融合效果
```

### 3. Wan2.2视频扩写
**适用场景**：视频生成、动态场景、镜头运动  
**优化重点**：
- 添加动态描述
- 镜头运动说明
- 时间序列描述
- 适合视频生成模型

**示例**：
```
输入：海浪拍打沙滩
输出：海浪缓缓涌向沙滩，白色的浪花在金色沙滩上散开，镜头从高处俯拍逐渐推近，展现浪花的细节，阳光洒在水面上形成波光粼粼的效果，海鸥在远处飞过，宁静而美好的海边场景，镜头平滑移动，捕捉每一个动态瞬间
```

## 🤖 模型选择

| 模型名称 | 特点 | 适用场景 |
|----------|------|----------|
| **GLM-4-Flash** | 速度快，成本低 | 日常使用、批量优化 |
| **GLM-4-Plus** | 质量高，理解深 | 复杂需求、创意扩写 |
| **GLM-4-Air** | 平衡性能 | 通用场景 |
| **GLM-4** | 标准版本 | 标准需求 |

## 🎯 使用优先级

节点按以下优先级处理优化指令：

1. **最高优先级**：自定义指令（custom_instruction）
   - 如果填写了自定义指令，将使用自定义指令
   - 完全自由控制优化方向

2. **默认优先级**：优化方案（optimization_preset）
   - 如果未填写自定义指令，使用选择的预设方案
   - 3种专业预设可选

3. **兜底方案**：即梦文生图
   - 如果以上都未设置，默认使用"即梦文生图"方案

## 🎲 种子控制

| 控制方式 | 说明 | 适用场景 |
|----------|------|----------|
| **随机** | 每次优化结果略有不同 | 探索多种扩写风格 |
| **固定** | 使用固定种子，结果一致 | 需要稳定输出 |
| **递增** | 种子值递增，渐进变化 | 批量生成变体 |

## 💡 使用技巧

### 1. 快速优化（使用预设）
```
场景：想快速优化提示词
配置：
- prompt："一个女孩在花园里"
- optimization_preset："即梦文生图"
- custom_instruction：留空
- model："GLM-4-Flash"

结果：快速生成优化后的详细提示词
```

### 2. 精确控制（自定义指令）
```
场景：有明确的优化要求
配置：
- prompt："日落"
- custom_instruction："请扩写成电影级的风景描述，强调色彩和氛围"
- model："GLM-4-Plus"

结果：按您的具体要求进行优化
```

### 3. 批量优化（固定种子）
```
场景：批量处理多个提示词，保持风格统一
配置：
- seed_control："固定"
- seed：12345
- temperature：0.3（降低随机性）
- optimization_preset："即梦文生图"

结果：所有提示词采用相似的优化风格
```

### 4. 创意探索（随机种子）
```
场景：想要多种不同的优化版本
配置：
- seed_control："随机"
- temperature：0.9（提高创造性）
- 多次运行同一提示词

结果：每次生成不同的优化版本
```

### 5. 渐进优化（递增种子）
```
场景：生成一系列渐进变化的版本
配置：
- seed_control："递增"
- batch运行多次

结果：生成系列相关但略有差异的优化提示词
```

## 📊 参数调优建议

### 标准优化模式
```
- model：GLM-4-Flash
- temperature：0.7
- top_p：0.9
- max_length：500
- 用途：日常使用，平衡质量和速度
```

### 高质量模式
```
- model：GLM-4-Plus
- temperature：0.6
- top_p：0.85
- max_length：800
- 用途：重要项目，追求最佳质量
```

### 创意模式
```
- model：GLM-4-Plus
- temperature：0.9
- top_p：0.95
- max_length：600
- 用途：艺术创作，探索新想法
```

### 稳定模式
```
- model：GLM-4-Flash
- temperature：0.3
- top_p：0.8
- seed_control：固定
- 用途：批量处理，需要一致性
```

## 🎯 自定义指令示例

### 场景1：强调特定风格
```
请将这个提示词扩写成赛博朋克风格，强调霓虹灯、未来科技感和暗黑色调
```

### 场景2：添加专业术语
```
请用专业摄影术语优化这个提示词，包括光圈、快门、ISO、焦距等参数描述
```

### 场景3：控制输出长度
```
请简洁地优化这个提示词，控制在100字以内，突出核心要素
```

### 场景4：特定AI模型优化
```
请针对Midjourney模型优化这个提示词，使用适合MJ的关键词和格式
```

### 场景5：情感氛围强化
```
请强化这个场景的情感氛围，添加更多描述氛围和情绪的词汇
```

## ⚙️ 温度与Top-P说明

### Temperature（温度）
控制输出的随机性和创造性：
- **0.1-0.3**：非常保守，输出稳定一致
- **0.4-0.6**：较为稳定，略有变化
- **0.7-0.8**：平衡模式（推荐）
- **0.9-1.0**：创造性强，输出多样

### Top-P（核采样）
控制词汇选择的范围：
- **0.7-0.8**：词汇选择保守，更专注
- **0.85-0.9**：平衡模式（推荐）
- **0.95-1.0**：词汇丰富，更有创意

### 组合建议
| 需求 | Temperature | Top-P | 效果 |
|------|-------------|-------|------|
| 稳定一致 | 0.3 | 0.8 | 批量处理 |
| 标准使用 | 0.7 | 0.9 | 日常优化 |
| 创意探索 | 0.9 | 0.95 | 艺术创作 |

## ⚠️ 注意事项

1. **优先级理解**：
   - 自定义指令优先级最高
   - 填写了自定义指令后，优化方案会被忽略
   - 建议二选一使用

2. **提示词输入**：
   - 支持中文和英文输入
   - 可以是简单关键词或完整描述
   - 越详细的输入，优化效果越好

3. **长度控制**：
   - `max_length` 是建议值，不是严格限制
   - AI可能会略微超出或不足
   - 过短的长度可能影响描述完整性

4. **种子值范围**：
   - 智谱AI种子值范围：1 - 2,147,483,647
   - 超出范围会自动映射到有效范围

5. **成本考虑**：
   - GLM-4-Flash：成本低，适合频繁使用
   - GLM-4-Plus：成本较高，建议重要场景使用
   - 较长的输出会增加token消耗

6. **预设模板修改**：
   - 预设模板位于 `glm_optimization_templates/` 目录
   - 可以编辑 `.txt` 文件自定义模板内容
   - 修改后重启ComfyUI生效

## 🔧 自定义优化模板

您可以编辑或新增优化模板：

1. 进入 `glm_optimization_templates/` 目录
2. 编辑现有 `.txt` 文件或创建新文件
3. 文件内容示例：

```
你是一个专业的AI绘画提示词优化专家。
请将用户输入的简短提示词扩写成详细、专业的AI绘画提示词。

要求：
1. 丰富画面细节描述
2. 添加专业术语（光线、构图、色彩等）
3. 保持语言流畅自然
4. 长度控制在200-500字
5. 适合Stable Diffusion等模型使用

请直接输出优化后的提示词，不要有其他说明。
```

4. 修改 `glm_nodes.py` 中的预设列表以使用新模板

## 🔧 配置文件

在 `glm_config.json` 中预设API密钥：

```json
{
    "api_key": "你的智谱AI密钥",
    "model": "GLM-4-Flash",
    "timeout": 60
}
```

## 📚 相关链接

- [智谱 AI 开放平台](https://open.bigmodel.cn/)
- [GLM-4 模型文档](https://open.bigmodel.cn/dev/api#glm-4)
- [如何获取 API Key](https://open.bigmodel.cn/usercenter/apikeys)
- [提示词工程最佳实践](https://open.bigmodel.cn/dev/howuse/prompts)

---

**作者**：@炮老师的小课堂  
**版本**：v3.1.1  
**更新日期**：2024年

