# Gemini 3 视频音频分析节点使用指南

## 📝 概述

Gemini 3 视频音频分析节点支持真实的视频文件和音频文件上传分析，使用 Gemini File API 处理大文件。

## 🆕 新功能

### 1. 真实视频文件上传
- **支持格式**：mp4, mov, avi, mkv, webm 等
- **使用方式**：在"🎬 视频文件路径"参数中输入完整的视频文件路径
- **示例**：`E:\Videos\sample.mp4`

### 2. 音频文件上传（修复版）
- **支持格式**：mp3, wav, m4a, ogg, flac 等
- **两种方式**：
  1. 文件路径：在"🎵 音频文件路径"参数中输入完整路径
  2. 音频节点：连接 ComfyUI 的音频输出节点到"🎵 音频"输入

### 3. 混合分析
- 可以同时上传图像、视频和音频
- 支持最多4张图像 + 1个视频 + 1个音频

## 🔧 两个节点的区别

### 💎 Gemini 3 多功能节点（原节点）
- **视频输入**：图像批次（IMAGE类型）- 将视频帧作为图像序列处理
- **音频输入**：使用 File API 上传（已修复）
- **适用场景**：
  - 需要对视频帧进行预处理
  - 只分析视频的部分帧
  - 与其他图像处理节点配合使用

### 🎬 Gemini 3 视频音频节点（新节点）
- **视频输入**：真实视频文件路径（STRING类型）
- **音频输入**：文件路径或音频节点
- **适用场景**：
  - 直接分析完整视频文件
  - 分析音频文件
  - 需要保留视频的时序信息
  - 处理长视频

## 📖 使用示例

### 示例1：分析视频文件
```
🎯 系统角色: 你是一个专业的视频分析师
💬 用户输入: 请详细描述这个视频的内容，包括场景、人物、动作等
🎬 视频文件路径: E:\Videos\sample.mp4
```

### 示例2：分析音频文件
```
🎯 系统角色: 你是一个专业的音频分析师
💬 用户输入: 请识别这段音频中的语音内容和背景音乐
🎵 音频文件路径: E:\Audio\speech.mp3
```

### 示例3：混合分析（图像+视频+音频）
```
🎯 系统角色: 你是一个多模态内容分析专家
💬 用户输入: 请综合分析这些图像、视频和音频，给出完整的内容描述
🖼️ 图像1: [连接图像节点]
🎬 视频文件路径: E:\Videos\sample.mp4
🎵 音频文件路径: E:\Audio\narration.wav
```

## ⚠️ 注意事项

1. **文件路径格式**：
   - Windows: `E:\folder\file.mp4`
   - Linux/Mac: `/home/user/folder/file.mp4`
   - 确保路径完整且文件存在

2. **文件大小限制**：
   - 单个文件建议不超过 100MB
   - 超大文件可能需要较长上传时间

3. **API密钥配置**：
   - 确保在配置文件中设置了正确的API密钥
   - 或在节点参数中直接输入API密钥

4. **镜像站选择**：
   - comfly: 推荐，速度快
   - hk: 香港节点
   - us: 美国节点

## 🐛 问题排查

### 音频无法识别
- ✅ 已修复：现在使用 File API 上传，不再使用 inline_data
- 确保音频文件格式正确（wav, mp3, m4a等）
- 检查文件路径是否正确

### 视频分析不准确
- 使用新的"🎬 Gemini 3 视频音频"节点
- 提供完整的视频文件路径，而不是图像批次
- 确保视频文件完整且未损坏

### 上传超时
- 检查网络连接
- 尝试使用较小的文件
- 切换不同的镜像站

## 📚 技术细节

### File API 工作流程
1. 将音频/视频文件上传到 Gemini File API
2. 获取文件 URI
3. 在 API 请求中使用 `file_data` 格式引用文件
4. API 处理完成后自动清理临时文件

### 音频处理流程
1. ComfyUI 音频 tensor → WAV 文件
2. 上传到 Gemini File API
3. 获取 file_uri
4. 发送分析请求

## 🔄 更新日志

### v1.0.0 (2024-11-25)
- ✅ 修复音频上传问题（使用 File API）
- ✅ 新增真实视频文件上传支持
- ✅ 保留原有图像批次功能
- ✅ 支持混合分析（图像+视频+音频）

---

👨‍🏫 作者：@炮老师的小课堂
📦 项目：ComfyUI-dapaoAPI
