# GLM 图像反推节点使用说明

## 📖 节点简介

GLM 图像反推节点基于智谱 AI 的 GLM-4V 多模态大模型，能够深入分析图像内容并生成详细的文本描述，非常适合用于生成图像的提示词。

## 🎯 主要功能

- ✅ 多图联合分析（最多4张图片）
- ✅ 智能提示词生成
- ✅ 详细场景描述
- ✅ 风格特征提取
- ✅ 种子控制（固定/随机/递增）
- ✅ 自定义分析角度

## 📝 参数说明

### 必填参数

| 参数名 | 类型 | 说明 |
|--------|------|------|
| **主图像 (image_main)** | IMAGE | 第一张必须的图片 |
| **API Key** | STRING | 智谱 AI API 密钥 |

### 可选参数

| 参数名 | 类型 | 默认值 | 说明 |
|--------|------|--------|------|
| **附加图像2-4** | IMAGE | 无 | 可选的额外图片（最多3张） |
| **自定义提示 (custom_prompt)** | STRING | 空 | 自定义分析指令 |
| **模型 (model)** | DROPDOWN | GLM-4V-Flash | 使用的 GLM 模型 |
| **详细程度 (detail_level)** | DROPDOWN | 标准 | 描述详细程度 |
| **输出格式 (output_format)** | DROPDOWN | 提示词 | 输出结果格式 |
| **种子控制 (seed_control)** | DROPDOWN | 随机 | 种子生成方式 |
| **种子值 (seed)** | INT | 0 | 固定种子值 |
| **温度 (temperature)** | FLOAT | 0.7 | 输出随机性（0.0-1.0） |

## 🤖 模型选择

| 模型名称 | 特点 | 适用场景 |
|----------|------|----------|
| **GLM-4V-Flash** | 速度快，成本低 | 日常使用、批量处理 |
| **GLM-4V-Plus** | 分析深入，质量高 | 专业需求、精细分析 |
| **GLM-4V** | 标准版本，平衡性能 | 通用场景 |

## 📊 详细程度说明

| 级别 | 输出长度 | 适用场景 |
|------|----------|----------|
| **简洁** | 50-100字 | 快速了解、标签生成 |
| **标准** | 100-200字 | 通用描述、提示词生成 |
| **详细** | 200-300字 | 深入分析、创作参考 |
| **极致** | 300-500字 | 专业分析、完整描述 |

## 📄 输出格式说明

### 1. 提示词格式
生成适合AI绘画的提示词格式：
```
一位年轻女性，长发飘逸，身穿白色连衣裙，站在樱花树下，温柔微笑，柔和光线，浅景深，高清摄影
```

### 2. 描述格式
生成自然语言描述：
```
这张图片展示了一位美丽的年轻女性。她拥有一头乌黑亮丽的长发，身穿一袭纯白色的连衣裙。
背景是盛开的樱花树，粉色的花瓣在微风中轻轻摇曳。女性的表情温柔甜美，眼神中透露出宁静与喜悦...
```

### 3. 结构化格式
生成分类整理的信息：
```
【主体】年轻女性
【服装】白色连衣裙
【发型】长发飘逸
【环境】樱花树下
【氛围】温柔宁静
【光线】柔和自然光
【拍摄】浅景深，高清
```

### 4. JSON格式
生成结构化数据：
```json
{
  "subject": "年轻女性",
  "appearance": "长发，白色连衣裙",
  "environment": "樱花树下",
  "mood": "温柔微笑",
  "lighting": "柔和光线",
  "style": "高清摄影"
}
```

## 🖼️ 多图分析

### 单图分析
最常用模式，深入分析一张图片：
```
输入：image_main（一张图）
输出：完整的图像描述或提示词
```

### 双图对比
分析两张图的异同：
```
输入：
- image_main：图片A
- image_2：图片B
- custom_prompt："对比这两张图的风格差异"

输出：对比分析结果
```

### 多图关联
分析多张图的关联关系：
```
输入：
- image_main + image_2 + image_3 + image_4（最多4张）
- custom_prompt："总结这组图片的共同主题"

输出：综合分析结果
```

### 系列图分析
生成系列图的统一风格描述：
```
输入：多张风格相似的图片
- custom_prompt："提取这些图片的共同风格特征"

输出：统一风格提示词
```

## 🎲 种子控制

| 控制方式 | 说明 | 适用场景 |
|----------|------|----------|
| **随机** | 每次分析结果略有不同 | 探索多种描述角度 |
| **固定** | 使用固定种子，结果一致 | 批量处理时保持风格统一 |
| **递增** | 种子值递增，渐进变化 | 生成系列变体描述 |

## 💡 使用技巧

### 1. 反推AI绘画提示词
```
配置：
- detail_level：标准
- output_format：提示词
- custom_prompt：留空（使用默认）

适合：将喜欢的图片转换为可用于AI绘画的提示词
```

### 2. 学习摄影构图
```
配置：
- detail_level：详细
- output_format：结构化
- custom_prompt："分析这张照片的构图、光线和色彩"

适合：学习摄影技巧
```

### 3. 风格提取
```
配置：
- 输入多张同风格图片
- custom_prompt："总结这种艺术风格的特点"
- output_format：描述

适合：风格学习与复现
```

### 4. 图像对比
```
配置：
- image_main + image_2
- custom_prompt："对比两张图的差异，生成改进建议"
- detail_level：详细

适合：版本对比、改进参考
```

### 5. 批量反推
```
配置：
- seed_control：固定
- output_format：提示词
- temperature：0.3（降低随机性）

适合：批量处理图库，生成统一风格的提示词
```

## 🎯 自定义提示词示例

### 场景1：生成AI绘画提示词
```
请用简洁的关键词描述这张图片，包括主体、风格、光线、色调，适合用于AI绘画
```

### 场景2：详细场景分析
```
请详细描述这张图片的场景、人物、环境、氛围、光线、色彩和构图
```

### 场景3：风格特征提取
```
请分析这张图片的艺术风格特点，包括绘画技法、色彩运用、构图特色
```

### 场景4：多图关联分析
```
请分析这几张图片之间的关联性，找出共同主题或风格特征
```

### 场景5：对比分析
```
请对比这两张图片的差异，从构图、色彩、风格、主题等角度进行分析
```

## ⚙️ 参数调优建议

### 快速预览模式
```
- model：GLM-4V-Flash
- detail_level：简洁
- temperature：0.5
- 用途：快速了解图片内容
```

### 标准使用模式
```
- model：GLM-4V-Flash
- detail_level：标准
- temperature：0.7
- output_format：提示词
- 用途：日常反推提示词
```

### 专业分析模式
```
- model：GLM-4V-Plus
- detail_level：极致
- temperature：0.5
- output_format：结构化
- 用途：深度分析、专业需求
```

### 批量处理模式
```
- model：GLM-4V-Flash
- detail_level：标准
- seed_control：固定
- temperature：0.3
- 用途：批量反推，保持一致性
```

## ⚠️ 注意事项

1. **图片质量**：
   - 建议使用清晰、高质量的图片
   - 模糊或低分辨率图片可能影响分析准确度

2. **多图分析**：
   - 第一张图（image_main）为主要分析对象
   - 附加图片作为补充参考
   - 最多支持4张图片同时分析

3. **温度参数**：
   - 较低（0.3-0.5）：结果稳定、一致性高
   - 中等（0.6-0.8）：平衡创造性和稳定性
   - 较高（0.9-1.0）：输出多样、更有创意

4. **种子控制**：
   - 智谱AI种子值范围：1 - 2,147,483,647
   - 超出范围会自动映射到有效范围

5. **API成本**：
   - GLM-4V-Flash：成本低，适合大量使用
   - GLM-4V-Plus：成本较高，适合精细需求
   - 多图分析会增加token消耗

6. **输出长度**：
   - 详细程度越高，生成时间越长
   - 根据实际需求选择合适级别

## 🔧 配置文件

在 `glm_config.json` 中预设API密钥：

```json
{
    "api_key": "你的智谱AI密钥",
    "model": "GLM-4V-Flash",
    "timeout": 60
}
```

## 📚 相关链接

- [智谱 AI 开放平台](https://open.bigmodel.cn/)
- [GLM-4V 模型文档](https://open.bigmodel.cn/dev/api#glm-4v)
- [如何获取 API Key](https://open.bigmodel.cn/usercenter/apikeys)

---

**作者**：@炮老师的小课堂  
**版本**：v3.1.1  
**更新日期**：2024年

